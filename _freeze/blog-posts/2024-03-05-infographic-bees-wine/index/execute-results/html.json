{
  "hash": "00309ea28b9ba1277ed7a9c2db1ed16d",
  "result": {
    "markdown": "---\ntitle: \"Relationship between bee behavior and vineyard types in Germany\"\ndescription: \"The process for creating an informative infographic through the use of data visualization techniques, and best practices\"\nauthor:\n  - name: Melissa Widas\n    url: http://mwidas.github.io\n    affiliation: MEDS\n    affiliation-url: http://ucsb-meds.github.io\ndate: 2024-03-05\nformat:\n  html:\n    code-fold: true\n    code-summary: \"Show Code!\"\ncode-overflow: wrap\ncode-block-bg: true\ncode-block-border-left: \"#6B5A75\"\ncategories: [MEDS, Visualizations]\ncitation: \n  url: http://mwidas.github.io/2024-03-05-infographic-bees-wine\nimage: 03_23_Bees_in_the_Vineyard.jpeg\ndraft: false\nbibliography: references.bib\n---\n\n\n## Background\n\narticle to check out: https://www.wineenthusiast.com/culture/wine/bees-role-vineyard-sustainability/\n\ndata citation - \\@wersebeckmann2022\n\n## The Product \n\n![](Feeling-buzzed.png){fig-alt=\"Infographic with a map of Germany with the Rheinfold-Pfalz region highlighted, a boxplot showing that between fallow, terraced, and vertically oriented vineyards above ground and below nesting bee distributions, and the top 10 species of bees for vertically oriented vineyards are all below ground nesting species, and an image depicting what a below ground hive structure\" fig-align=\"center\"}\n\n## How did we get here?\n\n### Top-Panel\n\n::: {.cell}\n\n```{.r .cell-code}\n#..........................load packages.........................\nlibrary(tidyverse)\nlibrary(chron)\nlibrary(naniar)\nlibrary(here)\nlibrary(janitor)\nlibrary(ggridges)\nlibrary(sf)\nlibrary(ggplot2)\nlibrary(ggspatial)\nlibrary(geomtextpath)\nlibrary(scales)\nlibrary(ggtext)\nlibrary(stringr)\nlibrary(patchwork)\nlibrary(showtext)\nlibrary(gghighlight)\n\n#..........................import fonts..........................\n# `name` is the name of the font as it appears in Google Fonts\n# `family` is the user-specified id that you'll use to apply a font in your ggpplot\nfont_add_google(name = \"Lobster\", family = \"lobster\")\nfont_add_google(name = \"Raleway\", family = \"raleway\")\n\n#................enable {showtext} for rendering.................\nshowtext_auto()\n\n#..........................data cleaning for map visualization.........................\n# read in data\ngermany_outline <- st_read(here::here(\"blog-posts\", \"2024-03-05-infographic-bees-wine\", \"data\", \"DEU_adm\", \"DEU_adm0.shp\"))\n\ngermany_regions <- st_read(here::here(\"blog-posts\", \"2024-03-05-infographic-bees-wine\", \"data\", \"DEU_adm\", \"DEU_adm1.shp\"))\n\nrhine <- germany_regions |> \n  filter(NAME_1 == \"Rheinland-Pfalz\")\n\n#..........................data cleaning for boxplot visualization.........................\n# use read_csv2() for files with a separator of ;\nbees <- read_csv2(here::here(\"blog-posts\", \"2024-03-05-infographic-bees-wine\", \"data\", \"doi_10_5061_dryad_h44j0zpq0__v20221222\", \"Wersebeckmann_et_al_wildbee_species_matrix_allSR.csv\"))\n\nbees_clean <- bees |> \n  \n  # apply lower snake case to all column names\n  clean_names() |> \n  \n  # coerce data type of site from character to factor\n  mutate(vineyard_type = as.factor(vineyard_type)) |> \n  \n  # select only columns of interest\n  select(vineyard_type, ground_nesting_spec_nr, above_ground_spec_nr, spec_nr) |> \n  \n  # turn nesting behavior and counts from 2 separate columns to a variable \n  pivot_longer(cols = c(ground_nesting_spec_nr, above_ground_spec_nr), names_to = \"nesting_behavior\", values_to = \"count\") |> \n  \n  # group by recorded nesting behavior for easier summarization\n  group_by(nesting_behavior)\n\n#..........................data cleaning for circular visualizations.........................\nbee_names <- read_csv2(here::here(\"blog-posts\", \"2024-03-05-infographic-bees-wine\", \"data\", \"doi_10_5061_dryad_h44j0zpq0__v20221222\", \"Wersebeckmann_et_al_wildbee_all_species_abbreviation.csv\"))\n\nbees_species <- bees |> \n  \n  # coerce data type of site from character to factor\n  mutate(VineyardType = as.factor(VineyardType)) |> \n  \n  select(-c(SamplingRound, Block, Winegrower, SpecNr, Ind, GroundNestingSpecNr, GroundNestingInd, AboveGroundSpecNr, AboveGroundInd, RlSpecNr, RlInd)) |> \n  \n  pivot_longer(!c(Site_ID, VineyardType), names_to = \"Abbreviation\", values_to = \"counts\") |> \n  \n  group_by(VineyardType, Abbreviation) |> \n  \n  summarize(mean_count = mean(counts))  |> \n  \n  top_n(10, mean_count)\n\nbees_species_names <- left_join(bees_species, bee_names, by = \"Abbreviation\") |> \n  clean_names()\n\n#..........................create vertically oriented subset.........................\nvo <- bees_species_names |> \n  filter(vineyard_type == \"Vertically oriented\") |> \n  mutate(mean_count = round(mean_count, 2)) |> \n  separate_wider_delim(full_name, delim = \" \",\n                       names = c(\"first\", \"second\"), too_many = \"merge\") |> \n  mutate(first = paste0(str_sub(first, 1, 1), \".\")) |> \n  unite(abb_full, c(first, second), sep = \" \")\n\n#........................create map of germany with region highlighted.......................\ngermany_map <- ggplot() +\n  geom_sf(data = germany_outline, color = \"#fec44f\", fill = \"#fec44f\") +\n  geom_sf(data = rhine, color = \"#662506\", fill = \"#662506\") +\n  # Customize general theme\n  theme(\n\n    # Set default color and font family for the text\n    text = element_text(family = \"raleway\", color = \"gray12\"),\n\n    # Make the background white and remove extra grid lines\n    panel.background = element_rect(fill = \"white\", color = \"white\"),\n    panel.grid = element_blank(),\n    panel.grid.major.x = element_blank(),\n    # Remove axis ticks and text\n    axis.title = element_blank(),\n    axis.ticks = element_blank(),\n    axis.text.y = element_blank(),\n    axis.text.x = element_blank(),\n    # Move the legend to the bottom\n    legend.position = \"left\",\n    legend.background = element_blank()\n  )  +\n  # add arrow and text to indicate region of Germany\n  annotate(\"curve\",\n           x = 8.2, xend = 7.5,\n           y = 51.3, yend = 50.8,\n           colour = \"black\", linewidth=1, alpha=1,\n           arrow=arrow()) +\n  annotate('text',\n    x = 10.2, y = 51.5,\n    label = 'Rheinland-Pfalz region \\nin Germany',\n    fontface = 'bold',\n    size = 4.5,\n    family = \"raleway\"\n  )\n\n#..........................create top panel of infographic.........................\n# initialize top panel and set layout specs\ntop_panel <- (germany_map + plot_spacer() +\n                plot_layout(widths = c(1.5, 3), guides = \"collect\")) +\n  \n  # set title and theme elements\n  plot_annotation(\n    title = 'Feeling Buzzed',\n    theme = theme(\n      plot.title = element_text(family = \"lobster\", face = \"bold\", size = 50, hjust = 0.5, color = \"gray12\"))) +\n  \n  # set subtitle and theme elements\n  plot_annotation(\n    subtitle = \"Exploring how bee behavior and presence is affected by vineyard type \\n in a wine-producing region in Germany\",\n    theme = theme(plot.subtitle = element_text(family = \"raleway\", face = \"bold\", size = 14, hjust = 0.5, color = \"gray12\")))\n\ntop_panel\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n### Middle Panel\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#..........................create boxplot of counts per vineyard type.........................\nbox_plot <- ggplot(bees_clean,\n                   aes(x = vineyard_type, y = count,\n                       color = nesting_behavior, fill = nesting_behavior)) +\n  geom_boxplot(alpha = 0.6) +\n  \n  # highlight vertically oriented vineyards and change alpha of others\n  gghighlight(vineyard_type == \"Vertically oriented\",\n              unhighlighted_params = list(colour = NULL, fill = NULL, alpha = 0.2)) +\n  \n  # specify custom color palette\n  scale_color_manual(values = c(\"#fe9929\", \"#662506\"),\n                     labels = c(\"Above Ground\", \"Below Ground\")) +\n  scale_fill_manual(values = c(\"#fec44f\", \"#662506\"),\n                    labels = c(\"Above Ground\", \"Below Ground\")) +\n  labs(\n    x = \"Vineyard Type\",\n    y = \"Avg. Number of Bee Species Observed\",\n    fill = \"Nesting Behavior:\",\n    colour = \"Nesting Behavior:\"\n  ) +\n  # Customize general theme\n  theme(\n    \n    # Set default color and font family for the text\n    text = element_text(family = \"raleway\", color = \"gray12\"),\n    \n    # Make the background white and remove extra grid lines\n    panel.background = element_rect(fill = \"white\", color = \"white\"),\n    panel.grid = element_blank(),\n    panel.grid.major.x = element_blank(),\n    panel.grid.major.y = element_line(color = \"gray\", linetype = \"dashed\"),\n    \n    # Update x-axis\n    axis.text.x = element_text(color = \"gray12\", size = 16,\n                               # bold vertically oriented on the x-axis\n                               face = c('plain', 'plain', 'bold')),\n    axis.ticks.x = element_blank(),\n    axis.title.x = element_text(color = \"gray12\", size = 18,\n                                face = \"bold\"),\n    \n    # Update y-axis\n    axis.text.y = element_text(color = \"gray12\", size = 12),\n    axis.title.y = element_text(color = \"gray12\", size = 18, face = \"bold\"),\n    axis.ticks.y = element_blank(),\n    \n    # Move the legend to the top\n    legend.position = \"top\",\n    legend.background = element_blank(),\n    legend.text = element_text(color = \"gray12\", size = 12, face = \"bold\"),\n    legend.title = element_text(color = \"gray12\", size = 18, face = \"bold\"),\n    \n  ) \n\nbox_plot\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n### Bottom Panel\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#..........................create circular chart of species counts.........................\n\n# create labels to add to the plot\nvo <- vo[order(vo$mean_count, decreasing = TRUE),]\n\ndata_with_labels_v <- vo |>\n  mutate(index_v = row_number())\n\n# number of labels required\nnumber_of_label_v <- nrow(data_with_labels_v)\n# find the angle of rotation of the label\nangle_v <-  -180 * (data_with_labels_v$index_v - 0.5) /number_of_label_v     \n\n# check the label alignment - right or left\ndata_with_labels_v$hjust<-ifelse(angle_v < -90, 1, 0)\n# check the label angle \ndata_with_labels_v$angle_v<-ifelse(angle_v < -90,\n                                   angle_v + 180, angle_v)\n\n# create column that includes the mean_count recorded for each species\ncount_v <- vo |> \n  distinct(breaks=abb_full, labs=paste0(abb_full, \" (\",mean_count,\")\"))\n\n# create circular bar chart plot\nvo_chart <- ggplot(data = vo,\n                   aes(x = reorder(abb_full, desc(mean_count)), y = mean_count,\n                       fill = nesting_trait)) +\n  geom_bar(stat = 'identity') +\n  labs(x = \"Bee Species\",\n       y = \"Number of Individuals per Species Sighted\",\n       fill = \"Nesting Behavior:\") +\n  \n  # set custom fill colors\n  scale_fill_manual(values = c(above.ground = \"#fec44f\", ground.nesting = \"#662506\"), labels = c(\"Above Ground\", \"Below Ground\")) +\n  \n  # customize character length before labels split lines to 5 characters\n  scale_x_discrete(labels = ~ str_wrap(as.character(count_v$labs), 5)) +\n  \n  # add dashed gray line surrounding figure at 13\n  geom_hline(yintercept = 13, color = \"gray\", linetype = \"dashed\", alpha = 0.5) +\n  \n  # turn bar chart into a circular bar chart \n  coord_polar(clip = \"off\") +\n  \n  # create gray dashed line that goes from end of bar to y-intercept line\n  geom_segment(\n    aes(\n      x =  reorder(abb_full, desc(mean_count)),\n      xend =  reorder(abb_full, desc(mean_count)),\n      yend = 13,\n    ), color = \"gray\", linetype = \"dashed\"\n  )  +\n  \n  # Customize general theme\n  theme(\n    \n    # Set default color and font family for the text\n    text = element_text(family = \"raleway\", color = \"gray12\"),\n    \n    # Customize the text in the title, subtitle, and caption\n    plot.title = element_text(face = \"bold\", size = 25, hjust = 0.5),\n    plot.subtitle = element_text(size = 14, hjust = 0.05),\n    plot.caption = element_text(size = 10, hjust = .5),\n    \n    # Make the background white and remove extra grid lines\n    panel.background = element_rect(fill = \"white\", color = \"white\"),\n    panel.grid = element_blank(),\n    panel.grid.major.x = element_blank(),\n    \n    # Remove axis ticks and text from y-axis\n    axis.text.y = element_blank(),\n    axis.title = element_blank(),\n    axis.ticks = element_blank(),\n    \n    # Use black italic text for the species names\n    axis.text.x = element_text(color = \"black\", face = \"italic\", size = 14,\n                               hjust = 0.5, vjust = 0),\n    \n    # remove legend\n    legend.position = \"none\"\n  ) \n\nvo_chart\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}